---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all published posts, sorted by date
const allPosts = await getCollection('posts', ({ data }) => data.published !== false);
const sortedPosts = allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Featured posts - pick a few recent ones with good excerpts
const featuredPosts = sortedPosts.slice(0, 5);

// Helper to check if a post is a poem
function isPoem(post: typeof allPosts[0]) {
  return post.data.categories?.includes('Poems') || post.data.tags?.includes('poem');
}
---

<BaseLayout>
  <!-- Season indicator -->
  <div class="season">
    <span class="season__dot"></span>
    Currently: Season of Awareness
  </div>

  <!-- Main headline -->
  <section class="intro">
    <h1>I think the meaning of life is to love and to be loved—and I'm curious about how to do both better.</h1>

    <p class="intro__text">
      I'm a maker of things—games, words, systems. I believe in discoverable depth:
      surfaces that reward curiosity. This is where I share what I'm learning.
    </p>
  </section>

  <!-- Divider -->
  <div class="divider"></div>

  <!-- Featured writing section -->
  <section>
    <h2>Featured Writing</h2>

    <div class="posts">
      {featuredPosts.map((post) => {
        const poem = isPoem(post);
        return (
          <a href={`/writing/${post.slug}/`} class:list={['post-entry', { 'post-entry--poem': poem }]}>
            <div class="post-entry__bar"></div>
            <div class="post-entry__header">
              <h3 class="post-entry__title">{post.data.title}</h3>
              <span class:list={['tag', { 'tag--poem': poem }]}>
                {poem ? 'poem' : 'essay'}
              </span>
            </div>
            {post.data.excerpt && (
              <p class="post-entry__excerpt">{post.data.excerpt}</p>
            )}
          </a>
        );
      })}
    </div>

    <p style="margin-top: var(--space-5);">
      <a href="/writing" style="color: var(--color-accent);">View all writing →</a>
    </p>
  </section>
</BaseLayout>
