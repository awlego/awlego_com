---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// Get all published posts, sorted by date
const allPosts = await getCollection('posts', ({ data }) => data.published !== false);
const sortedPosts = allPosts.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

// Helper to check if a post is a poem
function isPoem(post: typeof allPosts[0]) {
  return post.data.categories?.includes('Poems') || post.data.tags?.includes('poem');
}

// Format date
function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<BaseLayout title="Writing | Alex Wilson">
  <section class="intro">
    <h1>Writing</h1>

    <p class="intro__text">
      Essays on mental models, growth, and the things I'm trying to understand.
      Poems for the moments that ask for something else.
    </p>
  </section>

  <div class="divider"></div>

  <div class="posts">
    {sortedPosts.map((post) => {
      const poem = isPoem(post);
      return (
        <a href={`/writing/${post.slug}/`} class:list={['post-entry', { 'post-entry--poem': poem }]}>
          <div class="post-entry__bar"></div>
          <div class="post-entry__header">
            <h3 class="post-entry__title">{post.data.title}</h3>
            <span class:list={['tag', { 'tag--poem': poem }]}>
              {poem ? 'poem' : 'essay'}
            </span>
          </div>
          {post.data.excerpt && (
            <p class="post-entry__excerpt">{post.data.excerpt}</p>
          )}
          <p class="post-entry__date" style="font-family: var(--font-sans); font-size: 12px; color: var(--color-text-faint); margin-top: 8px; margin-bottom: 0;">
            {formatDate(post.data.date)}
          </p>
        </a>
      );
    })}
  </div>
</BaseLayout>
